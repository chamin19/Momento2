"use strict";
/**
 * Fetch wrapper for CJS builds - uses dynamic imports for node-fetch compatibility
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.getFetch = getFetch;
exports.getRequest = getRequest;
exports.getResponse = getResponse;
// Cache for the dynamically imported module
let nodeFetchModule = null;
/**
 * Get fetch function - uses dynamic import for CJS
 */
async function getFetch() {
    // In test environment, use global fetch (mocked by jest-fetch-mock)
    if (typeof global !== 'undefined' && global.fetch) {
        return global.fetch;
    }
    if (!nodeFetchModule) {
        // Use Function constructor to prevent TypeScript from converting to require()
        const dynamicImport = new Function('specifier', 'return import(specifier)');
        nodeFetchModule = (await dynamicImport('node-fetch'));
    }
    return nodeFetchModule.default;
}
/**
 * Get Request constructor - uses dynamic import for CJS
 */
async function getRequest() {
    // In test environment, use global Request or a mock
    if (typeof global !== 'undefined' && global.Request) {
        return global.Request;
    }
    if (!nodeFetchModule) {
        // Use Function constructor to prevent TypeScript from converting to require()
        const dynamicImport = new Function('specifier', 'return import(specifier)');
        nodeFetchModule = (await dynamicImport('node-fetch'));
    }
    return nodeFetchModule.Request;
}
/**
 * Get Response constructor - uses dynamic import for CJS
 */
async function getResponse() {
    // In test environment, use global Response or a mock
    if (typeof global !== 'undefined' && global.Response) {
        return global.Response;
    }
    if (!nodeFetchModule) {
        // Use Function constructor to prevent TypeScript from converting to require()
        const dynamicImport = new Function('specifier', 'return import(specifier)');
        nodeFetchModule = (await dynamicImport('node-fetch'));
    }
    return nodeFetchModule.Response;
}
